<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GPS + Turn-rate Tester</title>
<style>
  body{font-family:sans-serif;max-width:660px;margin:auto;padding:1rem}
  fieldset{margin:1rem 0;padding:.8rem}
  legend{font-weight:bold}
  label{display:block;margin:.35rem 0}
  input[type=text]{width:14rem}
  .status{margin:.5rem 0;font-weight:bold}
  button{margin-top:.4rem}
  .disabled{opacity:.45;pointer-events:none}
</style>
</head>
<body>
<h1>GPS WebSocket Tester</h1>

<!-- â¶ Connection -->
<fieldset>
  <legend>Server connection</legend>
  <label>Server IP / host:
    <input id="ip" type="text" value="127.0.0.1">
  </label>

  <label><input id="useVor" type="checkbox" onchange="updateVorUI()"> Use external VOR socket</label>

  <div id="vorBlock" style="display:none;margin-top:.6rem">
    <label>VOR WebSocket&nbsp;URL:
      <input id="vorUrl" type="text" value="ws://localhost:9000">
    </label>
    <div class="status" id="statusVor">ğŸ›° VOR: not connected</div>
  </div>

  <button onclick="connectSockets()">Connect</button>
  <button onclick="disconnectSockets()">Disconnect</button>

  <div class="status" id="statusCur">ğŸ›° /current: not connected</div>
  <div class="status" id="statusTgt">ğŸ¯ /target: not connected</div>
  <div class="status" id="statusRate">â¤µï¸ /rate: not connected</div>
</fieldset>

<!-- â· Turn-rate -->
<fieldset>
  <legend>Turn-rate (deg / s)</legend>
  <label>
    <input id="rateVal" type="text" value="10">
  </label>
  <button onclick="sendRate()">Send /rate</button>
</fieldset>

<!-- â¸ /current -->
<fieldset id="curField">
  <legend>Send /current (drone position)</legend>
  <label>Latitude  <input id="curLat" type="text" value="39.417790"></label>
  <label>Longitude <input id="curLon" type="text" value="-76.615905"></label>
  <label>Declination (Â° optional) <input id="curDec" type="text" placeholder="null"></label>
  <button onclick="sendCurrent()">Send /current</button>
</fieldset>

<!-- â¹ /target -->
<fieldset>
  <legend>Send /target (way-point)</legend>
  <label>Latitude  <input id="tgtLat" type="text" value="39.418000"></label>
  <label>Longitude <input id="tgtLon" type="text" value="-76.616500"></label>
  <label>Declination (Â° optional) <input id="tgtDec" type="text" placeholder="null"></label>
  <button onclick="sendTarget()">Send /target</button>
</fieldset>

<script>
let wsCur=null, wsTgt=null, wsVor=null, wsRate=null;

/* â€”â€”â€” UI â€”â€”â€” */
function setStatus(which,msg){
  const id = which==='Cur'?'statusCur':
             which==='Tgt'?'statusTgt':
             which==='Rate'?'statusRate':'statusVor';
  const prefix = which==='Cur'?'ğŸ›° /current: ':
                 which==='Tgt'?'ğŸ¯ /target: ':
                 which==='Rate'?'â¤µï¸ /rate: ':'ğŸ›° VOR: ';
  document.getElementById(id).textContent = prefix+msg;
}
function updateVorUI(){
  const on = document.getElementById('useVor').checked;
  document.getElementById('vorBlock').style.display = on?'block':'none';
  document.getElementById('curField').classList.toggle('disabled',on);
}

/* â€”â€”â€” connections â€”â€”â€” */
function connectSockets(){
  const host=document.getElementById('ip').value.trim();
  if(!host) return alert('Enter server IP/host');

  wsCur = new WebSocket(`ws://${host}:8765`);
  wsCur.onopen =()=>setStatus('Cur','âœ… connected');
  wsCur.onclose=()=>setStatus('Cur','ğŸ”Œ disconnected');
  wsCur.onerror=()=>setStatus('Cur','âŒ error');

  wsTgt = new WebSocket(`ws://${host}:8766`);
  wsTgt.onopen =()=>setStatus('Tgt','âœ… connected');
  wsTgt.onclose=()=>setStatus('Tgt','ğŸ”Œ disconnected');
  wsTgt.onerror=()=>setStatus('Tgt','âŒ error');

  wsRate = new WebSocket(`ws://${host}:8767`);
  wsRate.onopen =()=>setStatus('Rate','âœ… connected');
  wsRate.onclose=()=>setStatus('Rate','ğŸ”Œ disconnected');
  wsRate.onerror=()=>setStatus('Rate','âŒ error');

  if(document.getElementById('useVor').checked){
    const url=document.getElementById('vorUrl').value.trim();
    if(!url) return alert('Enter VOR URL');
    wsVor = new WebSocket(url);
    wsVor.onopen =()=>setStatus('Vor','âœ… connected');
    wsVor.onclose=()=>setStatus('Vor','ğŸ”Œ disconnected');
    wsVor.onerror=()=>setStatus('Vor','âŒ error');
    wsVor.onmessage=e=>{ if(isOpen(wsCur)) wsCur.send(e.data); };
  }
}
function disconnectSockets(){
  [wsCur,wsTgt,wsVor,wsRate].forEach(ws=>{ if(ws) ws.close(); });
  wsCur=wsTgt=wsVor=wsRate=null;
}
const isOpen = ws=>ws && ws.readyState===WebSocket.OPEN;

/* â€”â€”â€” send helpers â€”â€”â€” */
function buildPayload(pfx){
  const lat=parseFloat(document.getElementById(pfx+'Lat').value);
  const lon=parseFloat(document.getElementById(pfx+'Lon').value);
  let dec=document.getElementById(pfx+'Dec').value.trim();
  dec = dec?parseFloat(dec):null;
  return {latitude:lat, longitude:lon, declination:dec};
}
function sendCurrent(){
  if(!isOpen(wsCur)) return alert('/current not connected');
  const p=buildPayload('cur'); wsCur.send(JSON.stringify(p));
}
function sendTarget(){
  if(!isOpen(wsTgt)) return alert('/target not connected');
  const p=buildPayload('tgt'); wsTgt.send(JSON.stringify(p));
}
function sendRate(){
  if(!isOpen(wsRate)) return alert('/rate not connected');
  const val=parseFloat(document.getElementById('rateVal').value);
  if(isNaN(val)||val<=0) return alert('enter positive number');
  wsRate.send(JSON.stringify({turn_rate:val}));
}
</script>
</body>
</html>
