<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GPS WebSocket Tester</title>
<style>
  body{font-family:sans-serif;max-width:640px;margin:auto;padding:1rem}
  fieldset{margin:1rem 0;padding:.8rem}
  legend{font-weight:bold}
  label{display:block;margin:.35rem 0}
  input[type=text]{width:14rem}
  .status{margin:.5rem 0;font-weight:bold}
  button{margin-top:.4rem}
</style>
</head>
<body>
<h1>GPS WebSocket Tester</h1>

<!-- Connection -->
<fieldset>
  <legend>Server connection</legend>
  <label>Server IP / host:
    <input id="ip" type="text" value="127.0.0.1">
  </label>
  <button onclick="connectSockets()">Connect</button>
  <button onclick="disconnectSockets()">Disconnect</button>
  <div class="status" id="statusCur">🛰 /current: not connected</div>
  <div class="status" id="statusTgt">🎯 /target: not connected</div>
</fieldset>

<!-- /current sender -->
<fieldset>
  <legend>Send /current (drone position)</legend>
  <label>Latitude
    <input id="curLat"  type="text" value="39.4321748">
  </label>
  <label>Longitude
    <input id="curLon"  type="text" value="-76.6313836">
  </label>
  <label>Declination (° optional)
    <input id="curDec"  type="text" placeholder="null">
  </label>
  <button onclick="sendCurrent()">Send /current</button>
</fieldset>

<!-- /target sender -->
<fieldset>
  <legend>Send /target (way-point)</legend>
  <label>Latitude
    <input id="tgtLat"  type="text" value="39.43290">
  </label>
  <label>Longitude
    <input id="tgtLon"  type="text" value="-76.63210">
  </label>
  <label>Declination (° optional)
    <input id="tgtDec"  type="text" placeholder="null">
  </label>
  <button onclick="sendTarget()">Send /target</button>
</fieldset>

<script>
let wsCur=null, wsTgt=null;

function connectSockets(){
  const ip=document.getElementById('ip').value.trim();
  if(!ip){alert('Enter server IP / host');return;}

  wsCur = new WebSocket(`ws://${ip}:8765`);
  wsCur.onopen  =()=> setStatus('Cur','✅ connected');
  wsCur.onclose =()=> setStatus('Cur','🔌 disconnected');
  wsCur.onerror =()=> setStatus('Cur','❌ error');

  wsTgt = new WebSocket(`ws://${ip}:8766`);
  wsTgt.onopen  =()=> setStatus('Tgt','✅ connected');
  wsTgt.onclose =()=> setStatus('Tgt','🔌 disconnected');
  wsTgt.onerror =()=> setStatus('Tgt','❌ error');
}

function disconnectSockets(){
  if(wsCur){wsCur.close();wsCur=null;}
  if(wsTgt){wsTgt.close();wsTgt=null;}
}

function setStatus(which,msg){
  const el=document.getElementById(which==='Cur'?'statusCur':'statusTgt');
  el.textContent=(which==='Cur'?'🛰 /current: ':'🎯 /target: ')+msg;
}

function sendCurrent(){
  if(!open(wsCur)){alert('🛰 /current not connected');return;}
  const payload=buildPayload('cur');
  wsCur.send(JSON.stringify(payload));
  alert('Sent /current:\n'+JSON.stringify(payload,null,2));
}

function sendTarget(){
  if(!open(wsTgt)){alert('🎯 /target not connected');return;}
  const payload=buildPayload('tgt');
  wsTgt.send(JSON.stringify(payload));
  alert('Sent /target:\n'+JSON.stringify(payload,null,2));
}

function buildPayload(prefix){
  const lat=parseFloat(document.getElementById(prefix+'Lat').value);
  const lon=parseFloat(document.getElementById(prefix+'Lon').value);
  let dec=document.getElementById(prefix+'Dec').value.trim();
  dec = dec?parseFloat(dec):null;
  return {latitude:lat, longitude:lon, declination:dec};
}

const open = ws => ws && ws.readyState === WebSocket.OPEN;
</script>
</body>
</html>
